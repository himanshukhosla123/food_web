<!DOCTYPE html>
<html>
<head>
    <!-- {# Meta Tag #} -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="shortcut icon" type="image/png" href="/assets/ico/favicon.png"/>

    <title>{% block title %}{% endblock %}</title>

    <!-- {# CSS #} -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/assets/css/AdminLTE.min.css">
    <link rel="stylesheet" href="/assets/css/skin-blue.min.css">
    <link href="https://fonts.googleapis.com/css?family=Berkshire+Swash|Ceviche+One|Cookie|Kaushan+Script|Merienda+One|Oleo+Script|Pattaya|Playball|Sansita+One|Satisfy|Shrikhand|Yatra+One"
          rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/select2.min.css"/>
    <link rel="stylesheet" href="/assets/fonts/fonts.googleapis.com.css"/>
    <link rel="stylesheet" href="/assets/css/ace.min.css" class="ace-main-stylesheet"
          id="main-ace-style"/>
    <link rel="stylesheet" href="/assets/css/menu.css">
    <link rel="stylesheet" href="/assets/css/main.css">

    <link rel="stylesheet" href="/assets/css/popup_menu.css">
    <link rel="stylesheet" href="/assets/css/newpopup.css">
    <link href="/custom-auth/css/login.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/newpopup.css">
    <link href="/plugins/offline/offline-theme-dark.css" rel="stylesheet">
    <link href="/plugins/offline/offline-language-english.css" rel="stylesheet">
    <style>
        body {
            background-color: #ffffff;
            -webkit-user-select: none;
            -moz-user-select: -moz-none;
            -ms-user-select: none;
            user-select: none;
        }

        .navbar-nav > li,
        .navbar-nav a {
            height: 50px !important;
            vertical-align: middle;
            border: none !important;
        }

        .main-sidebar {
            position: fixed;
            overflow-x: hidden;
            overflow-y: scroll !important;
            top: 0;
            bottom: 0;
            height: 5px;
        }

        .main-sidebar::-webkit-scrollbar-track {
            -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            background-color: #222d32;
        }

        .main-sidebar::-webkit-scrollbar {
            width: 12px;
            background-color: #222d32;
        }

        .main-sidebar::-webkit-scrollbar-thumb {
            border-radius: 10px;
            -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, .3);
            background-color: #222d32;
        }

        .form-error {
            background: rgba(255, 255, 255, 0.5);
            color: white;
            margin-bottom: 0.5em;

            display: none;
        }

        .form-error i {
            color: red;
        }

        form input[type="text"] {
            text-transform: lowercase;
        }

        .fab-action-button {
            background-image: url("/help.png");
            background-size: 100%;
            width: 75px;
            height: 75px;
            background-color: transparent;
            border-radius: 50%;
            box-shadow: none;
        }

        .breadcrumb {
            margin: 10px 0;
            font-size: 15px;
        }
    </style>
</head>
<body class="hold-transition skin-blue sidebar-mini ">
<div class="wrapper">

    <header class="main-header">
        <div class="logo" style="position: fixed">
            <span class="logo-mini"><b>F</b></span>
            <span class="logo-lg"><b>Food</b>Cham</span>
        </div>
        <nav class="navbar navbar-fixed-top" role="navigation">

            <a href="#" class="sidebar-toggle hide_sidebar_button" data-toggle="offcanvas" role="button">
                <span class="sr-only">Toggle navigation</span>
            </a>

            <div class="navbar-custom-menu">
                <ul class="nav navbar-nav">
                    <!-- <li><span class="titanic titanic-toggle feature-list"></span></li> -->

                    <li>
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            {% if request.user|stringformat:"s" == "AnonymousUser" %}
                                <span class="hidden-xs">Welcome Guest</span>
                            {% else %}
                                <span class="hidden-xs">Welcome {{ request.user.users_name|title }}</span>
                            {% endif %}
                        </a>
                    </li>
                    <li>
                        <a href="/cart">
                            <i class="fa fa-shopping-cart" style="padding-right:8px; transform:scale(1.6)"></i>
                            Cart
                            <span id='cart-count-badge'
                                  style="padding-left:5px; font-weight:bold">{{ request.session.cart_item_count }}</span>
                        </a>
                    </li>
                    <li>
                        {% if request.user.is_authenticated %}
                            <a href="javascript:void(0)" id="logout">Logout</a>
                        {% else %}
                            <a href="/login" id="login">Login</a>
                        {% endif %}
                    </li>
                </ul>
            </div>
        </nav>
    </header>

    <div class="main-sidebar" id="main-sidebar">
        <section class="sidebar toggled">
            <div class="user-panel">
                <div class="pull-left image mascot-img">
                    <img src="/assets/img/food_champ.png" class="img-circle" alt="User Image">
                </div>
                <div class="pull-left info">
                    <p id="wish">Good Afternoon</p>
                    {% if request.user|stringformat:"s" == "AnonymousUser" %}
                        <i class="fa fa-circle text-success"></i> Guest
                    {% else %}
                        <i class="fa  text-success"></i>  Welcome {{ request.user.users_name| title }}
                    {% endif %}
                </div>
            </div>
            <form action="#" method="get" class="sidebar-form">
                <div class="input-group">
                    <input type="text" id="search" name="q" class="form-control" autocomplete="off"
                           placeholder="Search...">

                    <span class="input-group-btn">
                            <button type="submit" name="search" id="search-btn" class="btn btn-flat"><i
                                    class="fa fa-search"></i></button>
                        </span>
                </div>
            </form>

            <div id="search_result">
                <ul class="list-group"></ul>
            </div>

            <ul class="sidebar-menu hide_sidebar">
                <li><a href="/home"><i class="fa fa-link"></i> <span>Home</span></a></li>
                <li class="treeview">
                    <a href="/categories">
                        <i class="fa fa-link"></i> <span>Categories</span>
                    </a>
                </li>
                <li class="treeview">
                    <a href="#"><i class="fa fa-link"></i> <span>Menu</span> <i
                            class="fa fa-angle-left pull-right"></i></a>
                    <ul class="treeview-menu">
                        {% for category in queryset %}
                            {% if not category.meal_category %}
                                <li><a href='{{ category.get_absolute_url }}'>{{ category }}</a></li>
                            {% endif %}
                        {% endfor %}
                    </ul>
                </li>
                <!--
                <li class="treeview">
                    <a href="#"><i class="fa fa-link"></i> <span>Customization</span>
                        <i class="fa fa-angle-left pull-right"></i>
                    </a>
                    <ul class="treeview-menu">
                        <li><a href="#">Pizza</a></li>
                        <li><a href="#">Burgers</a></li>
                    </ul>
                </li>
                -->

                {% if request.user.is_authenticated %}
                    <li class="treeview">
                        <a href="/wishlist/{{ wishlist_id }}">
                            <i class="fa fa-link"></i> <span>Wishlist</span>
                        </a>
                    </li>
                {% else %}
                    <li class="treeview">
                        <a href="/login">
                            <i class="fa fa-link"></i> <span>Wishlist</span>
                        </a>
                    </li>
                {% endif %}
                <li class="treeview">
                    <a href="/feedback">
                        <i class="fa fa-link"></i> <span>Feedback</span>
                    </a>
                </li>

                {% if request.user.is_authenticated %}

                    <li class="treeview">
                        <a href="/bill">
                            <i class="fa fa-link"></i> <span>Generate Bill</span>
                        </a>
                    </li>

                {% endif %}

            </ul>
        </section>
    </div>

    <div class="content-wrapper">
        {% block body-content %}
        {% endblock %}
    </div>
</div>

<div class="fab">
    <a class="fab-action-button" href="javascript:void(0)" id='fab-help' class="fab-buttons__link">
    </a>
</div>

<!-- Modal for order when orders in cart equals 5 -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="myModalLabel" style="margin: 12px"></h4>
            </div>
            <div class="modal-body" style="color: white ;font-size:30px">
                Looks like you have selected more than 5 items, order these first so that we can serve you better!
            </div>
            <div class="modal-footer" style="text-align: right;">
                
                <button type="button"  style="text-align: center;"class="btn btn-default" data-dismiss="modal">Ignore</button>
                
                <a href="/cart/">
                    <button type="button" class="btn btn-primary">View In Cart</button>
                </a>
                <a href="/order/">
                    <button type="button" class="btn btn-primary">Order</button>
                </a>
            </div>
        </div>
    </div>
</div>
<div id="snackbar">Your order has been added to the cart.</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<script src="/assets/js/ace-extra.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-sweetalert/1.0.1/sweetalert.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="/assets/js/fuelux.wizard.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.16.0/jquery.validate.min.js"></script>
<script src="/assets/js/additional-methods.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.maskedinput/1.4.1/jquery.maskedinput.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/js/select2.min.js"></script>
<script src="/assets/js/ace-elements.min.js"></script>
<script src="/assets/js/ace.min.js"></script>
<script src="/assets/js/popup_menu.js" type="text/javascript"></script>
<script src="/assets/js/app.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/4.5.9/bodymovin.min.js"></script>
<script src="/assets/js/titanic.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/offline-js/0.7.19/offline.min.js"></script>
<script>
    jQuery(function ($) {
        $('[data-rel=tooltip]').tooltip();

        $(".select2").css('width', '200px').select2({allowClear: true})
            .on('change', function () {
                $(this).closest('form').validate().element($(this));
            });
        var $validation = false;
        $('#fuelux-wizard-container')
            .ace_wizard({})
            .on('actionclicked.fu.wizard', function (e, info) {
                if (info.step == 1 && $validation) {
                    if (!$('#validation-form').valid()) e.preventDefault();
                }
            })
            .on('finished.fu.wizard', function (e) {
                bootbox.dialog({
                    message: "Thank you! Your information was successfully saved!",
                    buttons: {
                        "success": {
                            "label": "OK",
                            "className": "btn-sm btn-primary"
                        }
                    }
                });
            }).on('stepclick.fu.wizard', function (e) {
        });

        $('#modal-wizard-container').ace_wizard();
        $('#modal-wizard .wizard-actions .btn[data-dismiss=modal]').removeAttr('disabled');

        $(document).one('ajaxloadstart.page', function (e) {
            $('[class*=select2]').remove();
        });
    });

    function show() {
        var elem = document.body;
        if ((document.fullScreenElement !== undefined && document.fullScreenElement === null) || (document.msFullscreenElement !== undefined && document.msFullscreenElement === null) || (document.mozFullScreen !== undefined && !document.mozFullScreen) || (document.webkitIsFullScreen !== undefined && !document.webkitIsFullScreen)) {
            if (elem.requestFullScreen) {
                elem.requestFullScreen();
            } else if (elem.mozRequestFullScreen) {
                elem.mozRequestFullScreen();
            } else if (elem.webkitRequestFullScreen) {
                elem.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);
            } else if (elem.msRequestFullscreen) {
                elem.msRequestFullscreen();
            }
        } else {
            if (document.cancelFullScreen) {
                document.cancelFullScreen();
            } else if (document.mozCancelFullScreen) {
                document.mozCancelFullScreen();
            } else if (document.webkitCancelFullScreen) {
                document.webkitCancelFullScreen();
            } else if (document.msExitFullscreen) {
                document.msExitFullscreen();
            }
        }
    }

    function launchIntoFullscreen(element) {
        if (element.requestFullscreen) {
            element.requestFullscreen();
        } else if (element.mozRequestFullScreen) {
            element.mozRequestFullScreen();
        } else if (element.webkitRequestFullscreen) {
            element.webkitRequestFullscreen();
        } else if (element.msRequestFullscreen) {
            element.msRequestFullscreen();
        }
    }

    function messagedelay() {
        $("#snackbar").replace("  ");
    }

    function setPrice() {
        var price = $(".variation_select option:selected").attr("data-price");
        var sale_price = $(".variation_select option:selected").attr("data-sale-price");
        if (sale_price != "" && sale_price != "None" && sale_price != null) {
            $("#price1").html("<h3>&#x20b9;" + sale_price + " <small class='og-price' style='text-decoration:line-through;color:#ff6600'>&#x20b9;" + price + "</small></h3>");
        } else {
            $("#price1").html("&#x20b9;" + price);
        }
    }

    function updateCartItemCount() {
        var badge = $("#cart-count-badge");
        $.ajax({
            type: "GET",
            url: "/cart_count",
            success: function (data) {
                badge.text(data.count);
            },
            error: function (response, error) {
                console.log(response);
                console.log(error);
            }
        })
    }

    function wish_msg() {

        var data = [
            [0, 12, "Good Morning"],
            [12, 18, "Good Afternoon"],
            [18, 24, "Good Evening"]
        ];
        var hr = new Date().getHours();

        for (var i = 0; i < data.length; i++) {
            if (hr >= data[i][0] && hr <= data[i][1]) {
                $("#wish").html(data[i][2]);
                break;
            }
        }
    }

    function showMessage() {
        console.log('showMessage called');
        // Get the snackbar DIV
        var x = document.getElementById("snackbar");

        // Add the "show" class to DIV
        x.className = "show";

        // After 2 seconds, remove the show class from DIV
        setTimeout(function () {
            x.className = x.className.replace("show", "");
        }, 2000);
    }

    var product_list = [];

    $(document).ready(function () {
        wish_msg();
        setPrice();
        updateCartItemCount();

        $(".sidebar-menu").css("font-size", "15px");

        $(".variation_select").change(function () {
            setPrice()
        });

        $('.btn1').click(function () {
            alert('fd');
        });

        $('#submit-btn').click(function (event) {
            event.preventDefault();
            var form_data = $("#add-form").serialize();
            var meal_form = $("#meal-form").serialize();
            new_form_data = meal_form + "&" + form_data;
            console.log(new_form_data)
            $.ajax({
                type: "GET",
                url: "/cart",
                data: new_form_data,
                success: function (data) {
                    if (data.item_added == true) {
                        $("#snackbar").text("item has been added to cart");
                        showMessage();
                    }
                    else if (data.deleted == true) {
                        $("#snackbar").text("Item has been deleted");
                        showMessage();
                    }
                    else {
                        $("#snackbar").text("Your Cart is updated");
                        showMessage();
                    }
                    updateCartItemCount();
                },
                error: function (response, error) {
                    $("#add-form").submit();
                }
            })
        });

        $('#fab-help').on('click', function () {
            swal({
                    title: "Need Steward Help?",
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#E64A19",
                    confirmButtonText: "Yup",
                    cancelButtonText: "Nope",
                    closeOnConfirm: false,
                    animation: true
                },
                function () {
                    $.ajax({
                        type: "GET",
                        url: "/notification/need-help/",
                        success: function (data) {
                            swal("Steward On The Way", "We Have Notified Waiter.", "success");
                        },
                        error: function (response, error) {
                            swal("Error", "Server Issue :(", "error");
                        }
                    });
                });
        });

        $.ajax({
            type: 'GET',
            url: '/api/products/',
            success: function (data) {
                $.each(data, function (i, product) {
                    product_list.push(product);
                });
            }
        });

        $('#search').focus(function () {
            $('#search_result').show();
        });

        $('#search').keyup(function () {
            $('#search_result').find('ul').empty();

            var search_term = $(this).val();

            var search = search_term.toLowerCase();
            var array = jQuery.grep(product_list, function (value, i) {
                return value.title.toLowerCase().indexOf(search) >= 0;
                //console.log(value.title);
            });
            $.each(array, function (i, arrq) {
                $('#search_result').find('ul').append("<li class='list-group-item'><a href='/products/" + arrq.id + "'>" + arrq.title + "</a></li>");
            });
        });

        var titanic;
        {% if  request.user.is_authenticated %}
            titanic = new Titanic({
                hover: false,
                click: true
            });
            function wishlist(status, id) {
                var url;

                if (status) {
                    url = '/wishlist/add/';
                } else {
                    url = '/wishlist/remove/';
                }

                $.ajax({
                    url: url + id,
                    success: function (result) {
                        console.log("success");
                    },
                    error: function () {
                        console.log("failed");
                    }
                });
            }
            $('.titanic-heart').click(function () {

                if ($(this).is('.active')) {
                    $('#snackbar').text('Product removed from your wishlist').css('border-bottom', '6px solid red');
                    wishlist(false, this.id);
                    $(this).removeClass('active');
                }
                else {
                    $('#snackbar').text('Product added to your wishlist').css('border-bottom', '6px solid green');
                    wishlist(true, this.id);
                    $(this).addClass('active');
                }

                $('#snackbar').addClass('show');

                setTimeout(function () {
                    $('#snackbar').removeClass('show')
                }, 2000);
            });
        {% else %}
            titanic = new Titanic({
                hover: false,
                click: false
            });
        {% endif %}

        $('#submit-btn').click(function () {
            if ($('#cart-count-badge').text() == 5) {
                $('#myModal').modal();
            }
        });
    });
</script>
<script>
    $(document).ready(function () {
        Offline.options = {
            checkOnLoad: false,
            interceptRequests: true,
            reconnect: {
                initialDelay: 3
            },
            requests: true,
            game: false
        };
        Offline.options = {
            checks: {
                xhr: {
                    url: '/internet-check/'
                }
            }
        };
        setInterval(function () {
            if (Offline.state === 'up')
                Offline.check();
        }, 5000);

        $('#logout').click(function () {
            swal({
                    title: "Are you sure?",
                    text: "We Will Gonna Miss You!",
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#DD6B55",
                    confirmButtonText: "Logout!",
                    closeOnConfirm: false
                },
                function () {
                    swal("Success", "You Are Successfully Logout.", "success");
                    setTimeout(function () {
                        window.location.href = '/logout';
                    }, 1000);
                });
        });
    });

</script>
</body>
</html>
